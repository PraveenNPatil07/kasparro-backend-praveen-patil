# Kasparro Infrastructure Blueprint
name: kasparro-system
databases:
  - name: kasparro-db
    databaseName: kasparro
    user: postgres
    plan: free

services:
  # 1. FastAPI Web Service
  - type: web
    name: kasparro-api
    env: docker
    dockerfile: Dockerfile
    plan: free # Change to 'starter' or higher for production
    healthCheckPath: /api/v1/health
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: kasparro-db
          property: connectionString
      - key: API_KEY
        generateValue: true
      - key: DEBUG
        value: "false"
    autoDeploy: true

  # 3. ETL Cron Job (Optional: Requires paid plan)
  # - type: cron
  #   name: kasparro-etl
  #   env: docker
  #   dockerfile: Dockerfile
  #   dockerCommand: python -m app.ingestion.runner
  #   schedule: "0 * * * *" # Runs every hour
  #   plan: starter # Cron jobs require a paid plan on Render
  #   envVars:
  #     - key: DATABASE_URL
  #       fromDatabase:
  #         name: kasparro-db
  #         property: connectionString
